{% extends 'layout.html.twig' %}

{% block body %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Magazines</h1>
  </div>

  {% if magazines is empty %}
    <p>No magazines found.</p>
  {% else %}
    <ul class="list-unstyled mb-3">
      {% for mag in magazines %}
        <li class="mb-2">
          <details open>
            <summary>
              <strong>üìÅ {{ mag.name }}</strong>
              <small class="text-muted">(slug: {{ mag.slug }})</small>
              <!-- Top-level Edit now points to wizard category management -->
              <a class="btn btn-sm ms-2" href="{{ path('mag_wizard_edit', {slug: mag.slug}) }}">Edit</a>
            </summary>
            {% if mag.categories is not empty %}
              <ul class="list-unstyled ms-3 mt-2">
                {% for cat in mag.categories %}
                  <li class="mb-1">
                    <details>
                      <summary>
                        üìÅ {{ cat.name }} <small class="text-muted">(slug: {{ cat.slug }})</small>
                        <a class="btn btn-sm ms-2" href="{{ path('admin_magazine_edit', {slug: cat.slug}) }}">Edit</a>
                      </summary>
                      {% if cat.files is not empty %}
                        <div class="ms-3 mt-2">
                          <table class="magazine-table">
                            <thead>
                              <tr>
                                <th>Article</th>
                                <th>Author</th>
                                <th>Date</th>
                                <th>Coordinate</th>
                              </tr>
                            </thead>
                            <tbody>
                            {% for file in cat.files %}
                              <tr>
                                <td>
                                  üìÑ <a href="{{ path('article-slug', {slug: file.slug|url_encode}) }}">{{ file.name }}</a>
                                  <div class="small text-muted">slug: {{ file.slug }}</div>
                                </td>
                                <td class="author">
                                  {% if file.authorPubkey %}
                                    <twig:Molecules:UserFromNpub :ident="file.authorPubkey" />
                                  {% else %}
                                    <span class="text-muted">unknown author</span>
                                  {% endif %}
                                </td>
                                <td class="author">
                                  {% if file.date %}
                                    <span class="small text-muted">{{ file.date|date('M j, Y') }}</span>
                                    <div class="small text-muted">{{ file.date|date('H:i') }}</div>
                                  {% else %}
                                    <span class="small text-muted">‚Äî</span>
                                  {% endif %}
                                </td>
                                <td class="small text-muted">{{ file.coordinate }}</td>
                              </tr>
                            {% endfor %}
                            </tbody>
                          </table>
                        </div>
                      {% else %}
                        <div class="ms-3 text-muted">No articles.</div>
                      {% endif %}
                    </details>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <div class="ms-3 text-muted">No categories.</div>
            {% endif %}
          </details>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endblock %}
