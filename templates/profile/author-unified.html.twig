{% extends 'layout.html.twig' %}

{% block ogtags %}
    <meta property="og:title" content="{{ author.name ?? author.display_name ?? npub }} - Newsroom">
    <meta property="og:type" content="profile">
    <meta property="og:url" content="{{ app.request.uri }}">
    {% if author.picture %}
        <meta property="og:image" content="{{ author.picture }}">
    {% endif %}
    {% if author.about %}
        <meta property="og:description" content="{{ author.about|striptags|u.truncate(159,'â€¦')|e }}">
    {% endif %}
    <meta property="og:site_name" content="Newsroom">

    {# JSON-LD Structured Data for Author Profile #}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "ProfilePage",
        "mainEntity": {
            "@type": "Person",
            "name": {{ (author.name ?? author.display_name ?? npub)|json_encode|raw }},
            "identifier": {{ npub|json_encode|raw }},
            "url": "{{ url(routePrefix ~ 'profile', useVanity ? {'vanity': profileId} : {'npub': profileId}) }}",
            {% if author.picture %}
            "image": {{ author.picture|json_encode|raw }},
            {% endif %}
            {% if author.about %}
            "description": {{ author.about|striptags|json_encode|raw }},
            {% endif %}
            {% if author.nip05 %}
            "email": {{ author.nip05|json_encode|raw }},
            {% endif %}
            {% if author.website %}
            "sameAs": {{ author.website|json_encode|raw }},
            {% endif %}
            "alumniOf": {
                "@type": "Organization",
                "name": "Nostr"
            }
        },
        "url": {{ app.request.uri|json_encode|raw }},
        "name": {{ (author.name ?? author.display_name ?? npub)|json_encode|raw }}
    }
    </script>
{% endblock %}

{% block body %}

    {% include 'partial/_author-section.html.twig' with {author: author, npub: npub, pubkey: pubkey} %}

    <section>
        <div class="profile-tabs" data-controller="content--author-profile-tabs"
             data-content--author-profile-tabs-pubkey-value="{{ pubkey }}"
             data-content--author-profile-tabs-hub-url-value="{{ mercure_public_hub_url }}"
             data-content--author-profile-tabs-active-tab-value="{{ activeTab ?? 'articles' }}">

            {# Public tabs - visible to everyone #}
            <a href="{{ path(routePrefix ~ 'profile-tab', useVanity ? {'vanity': profileId, 'tab': 'articles'} : {'npub': profileId, 'tab': 'articles'}) }}"
               class="tab-link {{ activeTab == 'articles' or activeTab is null ? 'active' : '' }}"
               data-content--author-profile-tabs-target="tab"
               data-tab="articles"
               data-turbo-frame="profile-tab-content"
               data-action="click->content--author-profile-tabs#switchTab">
                Articles
            </a>

            <a href="{{ path(routePrefix ~ 'profile-tab', useVanity ? {'vanity': profileId, 'tab': 'media'} : {'npub': profileId, 'tab': 'media'}) }}"
               class="tab-link {{ activeTab == 'media' ? 'active' : '' }}"
               data-content--author-profile-tabs-target="tab"
               data-tab="media"
               data-turbo-frame="profile-tab-content"
               data-action="click->content--author-profile-tabs#switchTab">
                Media
            </a>

            <a href="{{ path(routePrefix ~ 'profile-tab', useVanity ? {'vanity': profileId, 'tab': 'highlights'} : {'npub': profileId, 'tab': 'highlights'}) }}"
               class="tab-link {{ activeTab == 'highlights' ? 'active' : '' }}"
               data-content--author-profile-tabs-target="tab"
               data-tab="highlights"
               data-turbo-frame="profile-tab-content"
               data-action="click->content--author-profile-tabs#switchTab">
                Highlights
            </a>

            {# Private tabs - only visible to owner #}
            {% if isOwner %}
                <a href="{{ path(routePrefix ~ 'profile-tab', useVanity ? {'vanity': profileId, 'tab': 'drafts'} : {'npub': profileId, 'tab': 'drafts'}) }}"
                   class="tab-link {{ activeTab == 'drafts' ? 'active' : '' }}"
                   data-content--author-profile-tabs-target="tab"
                   data-tab="drafts"
                   data-turbo-frame="profile-tab-content"
                   data-action="click->content--author-profile-tabs#switchTab">
                    Drafts
                </a>

                {% if is_granted('ROLE_ADMIN') %}
                <a href="{{ path(routePrefix ~ 'profile-tab', useVanity ? {'vanity': profileId, 'tab': 'stats'} : {'npub': profileId, 'tab': 'stats'}) }}"
                   class="tab-link {{ activeTab == 'stats' ? 'active' : '' }}"
                   data-content--author-profile-tabs-target="tab"
                   data-tab="stats"
                   data-turbo-frame="profile-tab-content"
                   data-action="click->content--author-profile-tabs#switchTab">
                    Stats
                </a>
                {% endif %}

{#              Need to fix loading issues #}
{#              <a href="{{ path(routePrefix ~ 'profile-tab', useVanity ? {'vanity': profileId, 'tab': 'bookmarks'} : {'npub': profileId, 'tab': 'bookmarks'}) }}"#}
{#                   class="tab-link {{ activeTab == 'bookmarks' ? 'active' : '' }}"#}
{#                   data-content--author-profile-tabs-target="tab"#}
{#                   data-tab="bookmarks"#}
{#                   data-turbo-frame="profile-tab-content"#}
{#                   data-action="click->content--author-profile-tabs#switchTab">#}
{#                    Bookmarks#}
{#                </a>#}
            {% endif %}
        </div>

        {# Tab content container with Turbo Frame #}
        <turbo-frame id="profile-tab-content" data-content--author-profile-tabs-target="content">
            {% block tab_content %}
                {# Default content - articles tab #}
                {% include 'profile/tabs/_articles.html.twig' %}
            {% endblock %}
        </turbo-frame>
    </section>

{% endblock %}
