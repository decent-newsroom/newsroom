# Decent Newsroom - Environment Configuration
# ============================================
#
# This file contains default values for local development.
# Copy this file to `.env` and customize as needed.
#
# For production, create `.env.prod.local` with secure values.
# See docs/SETUP.md for complete setup guide.
#
# File loading order (later files override earlier):
#   .env ‚Üí .env.local ‚Üí .env.$APP_ENV ‚Üí .env.$APP_ENV.local
#
# ‚ö†Ô∏è  DO NOT COMMIT PRODUCTION SECRETS
# üîí = Must change for production
# ‚úÖ = Safe to use default locally

###> symfony/framework-bundle ###
# Application environment: dev, test, or prod
APP_ENV=dev

# üîí PRODUCTION: Generate new secret with `openssl rand -hex 32`
# Used for CSRF tokens, cookies, session encryption
APP_SECRET=9e287f1ad737386dde46d51e80487236
###< symfony/framework-bundle ###

###> docker / server ###
# Server hostname
# ‚úÖ Local: localhost
# üîí Production: your-domain.com (enables automatic Let's Encrypt TLS)
SERVER_NAME=localhost

# HTTP/HTTPS ports
# ‚úÖ Local: Using 8080/8443 avoids conflicts with other services
# ‚ö†Ô∏è Production: Use standard 80/443 for Let's Encrypt to work
HTTP_PORT=8080
HTTPS_PORT=8443
HTTP3_PORT=8443

# Trusted proxy IP ranges (for apps behind load balancers)
# ‚úÖ Default works for most setups
TRUSTED_PROXIES=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# Allowed hostnames (regex pattern)
# ‚úÖ Default allows all hosts
# üîí Production: ^(your-domain\.com|relay\.your-domain\.com)$
TRUSTED_HOSTS=.+
###< docker / server ###

###> database (postgresql) ###
# ‚úÖ Database name - safe to use default
POSTGRES_DB=newsroom_db

# ‚úÖ Database username - safe to use default
POSTGRES_USER=dn_user

# üîí PRODUCTION: Use strong password (generate with `openssl rand -base64 24`)
POSTGRES_PASSWORD=password

# ‚úÖ PostgreSQL version
POSTGRES_VERSION=17

# ‚úÖ Database character encoding
POSTGRES_CHARSET=utf8
###< database ###

###> doctrine/doctrine-bundle ###
# Database connection URL (composed from above variables)
# ‚úÖ No need to change - auto-composed
DATABASE_URL="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@database:5432/${POSTGRES_DB}?serverVersion=${POSTGRES_VERSION}&charset=${POSTGRES_CHARSET}"
###< doctrine/doctrine-bundle ###

###> mercure (real-time updates) ###
# Internal Mercure hub URL (used by Symfony to publish)
# ‚úÖ No need to change
MERCURE_URL=https://php/.well-known/mercure

# Public Mercure URL (used by browser clients)
# ‚úÖ Auto-composed from SERVER_NAME
MERCURE_PUBLIC_URL="https://${SERVER_NAME}/.well-known/mercure"

# üîí PRODUCTION: Generate all three with `openssl rand -hex 32`
MERCURE_JWT_SECRET="!NotSecretAtAll!"
MERCURE_PUBLISHER_JWT_KEY="!NotSoSecretMercureHubJWTSecretKey!"
MERCURE_SUBSCRIBER_JWT_KEY="!NotSoSecretMercureHubJWTSecretKey!"
###< mercure ###

###> redis (message queue) ###
# Redis hostname
# ‚úÖ Local: use 'redis' (Docker service name from compose.override.yaml)
# ‚ö†Ô∏è Production: use external Redis hostname or add Redis to compose.prod.yaml
REDIS_HOST=redis

# ‚úÖ Redis port - standard port
REDIS_PORT=6379

# üîí PRODUCTION: Use strong password
REDIS_PASSWORD=r_password
###< redis ###

###> symfony/messenger ###
# Message queue transport DSN (composed from Redis variables)
# ‚úÖ No need to change - auto-composed
MESSENGER_TRANSPORT_DSN="redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/1"
###< symfony/messenger ###

###> elasticsearch (optional search) ###
# Enable Elasticsearch for advanced search
# ‚úÖ Set to 'false' to use database queries instead (works fine for smaller sites)
ELASTICSEARCH_ENABLED=false

# Elasticsearch server configuration
# ‚ö†Ô∏è Only needed if ELASTICSEARCH_ENABLED=true
ELASTICSEARCH_HOST=localhost
ELASTICSEARCH_PORT=9200
ELASTICSEARCH_USERNAME=elastic
ELASTICSEARCH_PASSWORD=your_password

# Index names
ELASTICSEARCH_INDEX_NAME=articles
ELASTICSEARCH_USER_INDEX_NAME=users
###< elasticsearch ###

###> nostr relay ###
# Domain for the Nostr relay WebSocket endpoint
# ‚úÖ Local: relay.localhost
# üîí Production: relay.your-domain.com (needs DNS A record)
RELAY_DOMAIN=relay.localhost

# Internal relay WebSocket URL (Symfony app ‚Üí relay)
# ‚úÖ Use Docker service name internally
NOSTR_DEFAULT_RELAY=ws://strfry:7777

# The following relay settings are not implemented in full yet and can be skipped
# Upstream relays to sync articles from (space-separated, must be quoted)
# ‚úÖ Popular public relays - add/remove as needed
# RELAY_UPSTREAMS="wss://relay.snort.social wss://relay.damus.io wss://theforest.nostr1.com wss://relay.primal.net"

# How many days of content to sync from upstream relays
# ‚úÖ Adjust based on your storage capacity
# RELAY_DAYS_ARTICLES=7
# RELAY_DAYS_THREADS=3
###< nostr relay ###

###> contribution/donation settings ###
# Project contribution settings - displayed in left navigation
# ‚úÖ Leave empty to hide contribution section
# üîí Production: Set to your project's npub and lightning address
PROJECT_CONTRIBUTION_NPUB=
PROJECT_CONTRIBUTION_LUD16=
###< contribution/donation settings ###

# =============================================================================
# QUICK REFERENCE: Production Minimum Changes
# =============================================================================
# Copy these to .env.prod.local and replace with real values:
#
# APP_ENV=prod
# APP_SECRET=<openssl rand -hex 32>
# SERVER_NAME=your-domain.com
# POSTGRES_PASSWORD=<strong-password>
# MERCURE_JWT_SECRET=<openssl rand -hex 32>
# MERCURE_PUBLISHER_JWT_KEY=<openssl rand -hex 32>
# MERCURE_SUBSCRIBER_JWT_KEY=<openssl rand -hex 32>
# REDIS_PASSWORD=<strong-password>
# RELAY_DOMAIN=relay.your-domain.com
# PROJECT_CONTRIBUTION_NPUB=<your-project-npub>
# PROJECT_CONTRIBUTION_LUD16=<your-lightning-address>
# =============================================================================
